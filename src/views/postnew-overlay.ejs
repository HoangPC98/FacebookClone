
<link rel="stylesheet" href="/css/homecss/home-post-box.css">

   <div class="overplay post-new">
    <div class="overplay-body">
        
        <!-- Box news feed -->
        <div class="post-box">
            <div class="post-box__head">
                <h3 class="post-box__head-text">
                    Tạo bài viết
                </h3>
                <span class="post-box__head-close" id="close-post-box">
                    <i class="fas fa-times"></i>
                </span>
            </div>
            <div class="post-box__main">
                <div class="post-box__info">
                    <img src="" alt="" class="avt post-box__avatar" id="avatar-postnew-overlay">    
                    <div class="post-box__info-info">
                        <p class="post-box__info-name full-name">
                
                        </p>
                        <div class="post-box__info-object">
                            <i class="fas fa-globe-europe"></i>
                            Công khai
                        </div>
                    </div>
                </div>

                <form class="form-submit-new-post" action="/postnew" method="post" enctype="multipart/form-data">
                    <div class="post-box__content">
                        <textarea name="content" placeholder="Bạn đang nghĩ gì thế ?" type="text" class="post-box__content-textarea" style="min-height: 40px;"></textarea>
                        <input type="hidden" class="uid-post" name="uid" value="">
                        <input type="hidden" class="date-time-post" name="date_time_post" value="">
                        <div class="post-box__content-img">
                            <img class="img-preview" src="" width="100%" alt="">
                            <span>&times;</span>
                        </div>
                    </div>
                    <div class="post-box__add">
                        <div class="post-box__add-head">
                            Thêm vào bài viết
                        </div>
                            <div class="post-box__add-more">
                                <div class="post-box__add-icon uploadfile">
                                    <input type="file" class="input-upload" name="postimg" id="image" hidden="hidden">
                                    <i style="color: #45bd62;" class="fas fa-images"></i>
                                </div>
                                <div class="post-box__add-icon">
                                    <i style="color: #f7b928;" class="fas fa-laugh"></i>
                                </div>
                                <div class="post-box__add-icon">
                                    <i style="color: #f5533d;" class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="post-box__add-icon">
                                    <i style="color: #717880;" class="fas fa-ellipsis-h"></i>
                                </div>
                                <!-- <button type="submit" class="btn-submit-file">SUBMIT</button> -->
                            </div>
                    </div>
                    <button type="button" class="post-box__btn btn-disable">Đăng</button>

                </form>
            </div>
        </div>

    </div>
</div>

<script>
    document.querySelector('#close-post-box').onclick = ()=>{
        document.querySelector('.overplay.post-new').style.display = 'none';
    }
    document.querySelector('.post-box__info-name.full-name').innerHTML = Json_cookie.userName
    document.querySelector('#avatar-postnew-overlay').src = Json_cookie.avatar
    document.querySelector('.post-box__content-textarea').oninput = function(e){
        if(e.target.value != ''){
            console.log('ok nha')
            document.querySelector('.post-box__btn').classList.add('btn-active');
        }
        else{
            document.querySelector('.post-box__btn').classList.remove('btn-active')
        }  
    }

    // Upload FIle
    document.querySelector('.post-box__add-icon.uploadfile').onclick = ()=>{
        console.log('hahahaha')
        document.querySelector('.input-upload').click()
    }

 


    function getCookie(cName) {
        const name = cName + "=";
        const cDecoded = decodeURIComponent(document.cookie); //to be careful
        const cArr = cDecoded.split('; ');
        let res;
        cArr.forEach(val => {
            if (val.indexOf(name) === 0) res = val.substring(name.length);
        })
        return res
    }
   
        
        // document.querySelector('.overplay.post-new').style.display = 'none'
        document.querySelector('.input-upload').onchange = function(e){
            if(e.target.files.length >0){
                let src = URL.createObjectURL(e.target.files[0])
                document.querySelector('.img-preview').src = src
                document.querySelector('.img-preview').style.display = 'block'
            }
        }

        

        document.querySelector('.post-box__btn').onclick = function(){
            document.querySelector('.uid-post').value = Json_cookie.userId
            document.querySelector('.date-time-post').value = Date.now()
            document.querySelector('.form-submit-new-post').submit()
            document.querySelector('.overplay.post-new').style.display = 'none'
            // let content = $('.post-box__content-textarea').val()
            // let datetime = new Date().toLocaleDateString('en-US',{ year: 'numeric', month: 'long', day: '2-digit'})
            // let dataPost ={uid, content, datetime}
            // let options = {
            //     method: 'POST',
            //     headers: { "Content-type": "application/json; charset=UTF-8" },
            //     body: JSON.stringify(dataPost)
            // }

            // fetch('/postnew', options)
            // .then(res=>{
            //     if(!res.ok){
            //         console.error(res)
            //         console.log('post that bai')
                    
            //     }
            //     else{
            //         console.log('post thanh cogn')
            //         res.json()

            //     }
            // })


        }
</script>